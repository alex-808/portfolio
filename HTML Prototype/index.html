<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Alex Davis</title>
        <meta charset="utf-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0, user-scalable=no"
        />
        <link type="text/css" rel="stylesheet" href="main.css" />
    </head>
    <body>
        <main>
            <canvas id="main_canvas"></canvas>

            <section class="hero_section">
                <div class="hero_accent_box"></div>
                <div class="hero_texts">
                    <h1 class="hero_title">Hello,</h1>
                    <p class="hero_text">
                        My name is Alex and this is my website etc. Lorem ipsum
                        dolor sit amet, consectetur adipiscing elit. Cras nibh
                        magna, condimentum non pulvinar nec, semper vel ipsum.
                    </p>
                </div>
                <div id="hero_animation"></div>
            </section>

            <section class="spec_section">
                <div class="spec_header_box"></div>
                <div class="spec_item_container">
                    <div class="spec_item">
                        <img class="spec_icon" src="./imgs/fingerprint.svg" />
                        <h2 class="spec_title">Who I am</h2>
                        <p class="spec_text">
                            Lorem ipsum dolor sit amet, consectetur adipiscing
                            elit. Cras nibh magna, condimentum non pulvinar nec,
                            semper vel ipsum. Nulla facilisi. Suspendisse potent
                        </p>
                    </div>
                    <div class="spec_item">
                        <img class="spec_icon" src="./imgs/code.svg" />
                        <h2 class="spec_title">What I do</h2>
                        <p class="spec_text">
                            Lorem ipsum dolor sit amet, consectetur adipiscing
                            elit. Cras nibh magna, condimentum non pulvinar nec,
                            semper vel ipsum. Nulla facilisi. Suspendisse potent
                        </p>
                    </div>
                    <div class="spec_item">
                        <img class="spec_icon" src="./imgs/checkmark.svg" />
                        <h2 class="spec_title">What I know</h2>
                        <p class="spec_text">
                            Lorem ipsum dolor sit amet, consectetur adipiscing
                            elit. Cras nibh magna, condimentum non pulvinar nec,
                            semper vel ipsum. Nulla facilisi. Suspendisse potent
                        </p>
                    </div>
                </div>
            </section>

            <section class="port_section">
                <h1 class="port_title">Past Projects</h1>
                <div class="port_container">
                    <div class="port_item port_left">
                        <h2 class="proj_title">Project Title</h2>
                        <img class="proj_img" src="imgs/proj_img.png" />
                        <p class="proj_text">
                            Lorem ipsum dolor sit amet, consectetur adipiscing
                            elit. Cras nibh magna, condimentum non pulvinar nec,
                            semper vel ipsum. Nulla facilisi. Suspendisse potent
                        </p>
                        <div class="port_accent"></div>
                    </div>
                    <div class="port_item port_right">
                        <h2 class="proj_title">Project Title</h2>
                        <img class="proj_img" src="imgs/proj_img.png" />
                        <p class="proj_text">
                            Lorem ipsum dolor sit amet, consectetur adipiscing
                            elit. Cras nibh magna, condimentum non pulvinar nec,
                            semper vel ipsum. Nulla facilisi. Suspendisse potent
                        </p>
                        <div class="port_accent"></div>
                    </div>
                    <div class="port_item port_left">
                        <h2 class="proj_title">Project Title</h2>
                        <img class="proj_img" src="imgs/proj_img.png" />
                        <p class="proj_text">
                            Lorem ipsum dolor sit amet, consectetur adipiscing
                            elit. Cras nibh magna, condimentum non pulvinar nec,
                            semper vel ipsum. Nulla facilisi. Suspendisse potent
                        </p>
                        <div class="port_accent"></div>
                    </div>
                    <div class="port_item port_right">
                        <h2 class="proj_title">Project Title</h2>
                        <img class="proj_img" src="imgs/proj_img.png" />
                        <p class="proj_text">
                            Lorem ipsum dolor sit amet, consectetur adipiscing
                            elit. Cras nibh magna, condimentum non pulvinar nec,
                            semper vel ipsum. Nulla facilisi. Suspendisse potent
                        </p>
                        <div class="port_accent"></div>
                    </div>
                </div>
            </section>

            <section class="about_me_section">
                <h1 class="about_me_title">About Me</h1>
                <p class="about_me_text">
                    Lorem ipsum dolor sit amet, consectetur adipiscing elit.
                    Cras nibh magna, condimentum non pulvinar nec, semper vel
                    ipsum. Nulla facilisi. Suspendisse potent Lorem ipsum dolor
                    sit amet, consectetur adipiscing elit. Cras nibh magna,
                    condimentum non pulvinar nec, semper vel ipsum. Nulla
                    facilisi. Suspendisse potent Lorem ipsum dolor sit amet,
                    consectetur adipiscing elit. Cras nibh magna, condimentum
                    non pulvinar nec, semper vel ipsum. Nulla facilisi.
                    Suspendisse potent
                </p>
            </section>

            <section class="footer_section">
                <div class="footer_accent">Call to Action</div>
                <div class="social_icons">
                    <img class="social_icon" src="imgs/checkmark.svg" />
                    <img class="social_icon" src="imgs/checkmark.svg" />
                    <img class="social_icon" src="imgs/checkmark.svg" />
                </div>
                <div id="footer_animation"></div>
            </section>
        </main>

        <!-- Scripts -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.5/dat.gui.min.js"></script>
        <script src="./three/examples/js/libs/ammo.wasm.js"></script>
        <!-- Vertex Shader -->
        <script>
            var vertexShader = `
			  varying vec3 vPos;
			  void main()	{
				vPos = position;
				gl_Position = projectionMatrix * modelViewMatrix * vec4(position,1.0);
			  }
			`;
            var fragmentShader = `

              varying vec3 vPos;
              uniform vec3 size;
              uniform float thickness;
              uniform float smoothness;

              void main() {

            	float a = smoothstep(thickness, thickness + smoothness, length(abs(vPos.xy) - size.xy));
            	a *= smoothstep(thickness, thickness + smoothness, length(abs(vPos.yz) - size.yz));
            	a *= smoothstep(thickness, thickness + smoothness, length(abs(vPos.xz) - size.xz));

            	vec3 c = mix(vec3(0), vec3(1), a);

            	gl_FragColor = vec4(c, 1.0);
              }
            `;

            var accentFragmentShader = `
		  
          varying vec3 vPos;
          uniform vec3 size;
          uniform float thickness;
          uniform float smoothness;
         
          void main() {
                  
            float a = smoothstep(thickness, thickness + smoothness, length(abs(vPos.xy) - size.xy));
            a *= smoothstep(thickness, thickness + smoothness, length(abs(vPos.yz) - size.yz));
            a *= smoothstep(thickness, thickness + smoothness, length(abs(vPos.xz) - size.xz));
            
            vec3 c = mix(vec3(0), vec3(0.0627, 0.9137, 0.9333), a);
            
            gl_FragColor = vec4(c, 1.0);
          }
        `;
        </script>
        <!-- Main Animation -->
        <script type="module">
            import * as THREE from './three/build/three.module.js';
            import { OrbitControls } from './three/examples/jsm/controls/OrbitControls.js';
            import { AmmoPhysics } from './three/examples/jsm/physics/AmmoPhysics.js';
            import Stats from './three/examples/jsm/libs/stats.module.js';

            let camera, scene, renderer, stats;
            let physics, position;
            let hero_boxes, spheres, wireFrames;
            let footer_boxes;
            // originally 180
            var hero_boxcount = 100;
            var footer_boxcount = 20;
            let flowControlPositions;
            let hero_lift_index = 0;
            let footer_lift_index = 0;
            let hero_scene;
            let footer_scene;
            let accent_color;

            init();

            async function init() {
                physics = await AmmoPhysics();
                position = new THREE.Vector3();

                //Scenes

                function makeScene(elem) {
                    const scene = new THREE.Scene();
                    const fov = 50;
                    const aspect = window.innerWidth / window.innerHeight; // the canvas default
                    const near = 0.1;
                    const far = 1000;
                    const camera = new THREE.PerspectiveCamera(
                        fov,
                        aspect,
                        near,
                        far
                    );
                    camera.position.set(1.4, 3.7, 1);
                    camera.rotation.x = 1;
                    camera.rotation.y = 1.7;
                    camera.rotation.z = -0.7;
                    // camera.lookAt(0, 0, 0);

                    return { scene, camera, elem };
                }

                hero_scene = setupScene(
                    document.querySelector('#hero_animation')
                );
                footer_scene = setupScene(
                    document.querySelector('#footer_animation')
                );

                function setupScene(elem) {
                    const sceneInfo = makeScene(elem);
                    const geometryBox = new THREE.BoxBufferGeometry(
                        0.2,
                        0.2,
                        0.2
                    );
                    const material = new THREE.ShaderMaterial({
                        uniforms: {
                            size: {
                                value: new THREE.Vector3(
                                    geometryBox.parameters.width,
                                    geometryBox.parameters.height,
                                    geometryBox.parameters.depth
                                ).multiplyScalar(0.5),
                            },
                            thickness: {
                                value: 0.002,
                            },
                            smoothness: {
                                value: 0.001,
                            },
                        },
                        vertexShader: vertexShader,
                        fragmentShader: fragmentShader,
                    });
                    const accent_material = new THREE.ShaderMaterial({
                        uniforms: {
                            size: {
                                value: new THREE.Vector3(
                                    geometryBox.parameters.width,
                                    geometryBox.parameters.height,
                                    geometryBox.parameters.depth
                                ).multiplyScalar(0.5),
                            },
                            thickness: {
                                value: 0.002,
                            },
                            smoothness: {
                                value: 0.001,
                            },
                        },
                        vertexShader: vertexShader,
                        fragmentShader: accentFragmentShader,
                    });
                    sceneInfo.geometry = geometryBox;
                    sceneInfo.material = material;
                    sceneInfo.accent_material = accent_material;

                    return sceneInfo;
                }

                // Camera

                scene = new THREE.Scene();

                // Flow Control Object

                const flowControl = new THREE.Mesh(
                    new THREE.BoxBufferGeometry(5, 0.5, 5),
                    new THREE.MeshBasicMaterial({ color: 'blue' })
                );
                flowControlPositions = {
                    xRotation: 9.7,
                    yRotation: 0,
                    zRotation: 8.5,
                    xPosition: 0,
                    yPosition: 4,
                    zPosition: -2,
                };

                flowControl.rotation.x = flowControlPositions.xRotation;
                flowControl.rotation.z = flowControlPositions.zRotation;
                flowControl.position.y = flowControlPositions.yPosition;
                flowControl.position.x = flowControlPositions.xPosition;
                flowControl.position.z = flowControlPositions.zPosition;
                flowControl.receiveShadow = true;
                // scene.add( flowControl );
                physics.addMesh(flowControl);

                const flowControl2 = new THREE.Mesh(
                    new THREE.BoxBufferGeometry(5, 0.5, 5),
                    // new THREE.ShadowMaterial( { color: 'blue' } )
                    new THREE.MeshBasicMaterial({ color: 'blue' })
                );
                flowControl2.rotation.x = flowControlPositions.xRotation;
                flowControl2.rotation.z = -flowControlPositions.zRotation;
                flowControl2.position.y = flowControlPositions.yPosition;
                flowControl2.position.x = flowControlPositions.xPosition;
                flowControl2.position.z = flowControlPositions.zPosition;
                flowControl2.receiveShadow = true;
                // scene.add( flowControl2 );
                physics.addMesh(flowControl2);

                // Hero Boxes

                hero_boxes = [];
                footer_boxes = [];

                for (let i = 0; i < hero_boxcount; i++) {
                    if (i < 1) {
                        var box = new THREE.Mesh(
                            hero_scene.geometry,
                            hero_scene.accent_material
                        );
                    } else {
                        var box = new THREE.Mesh(
                            hero_scene.geometry,
                            hero_scene.material
                        );
                    }

                    console.log('this');
                    hero_scene.scene.add(box);
                    hero_boxes.push(box);
                    physics.addMesh(box, 10);
                    box.castShadow = true;
                    box.receiveShadow = true;
                }

                // Footer Boxes
                for (let i = 0; i < footer_boxcount; i++) {
                    var footer_box = new THREE.Mesh(
                        footer_scene.geometry,
                        footer_scene.material
                    );

                    footer_box.castShadow = true;
                    footer_box.recieveShadow = true;
                    footer_scene.scene.add(footer_box);
                    footer_boxes.push(footer_box);
                    physics.addMesh(footer_box, 10);
                }

                // Footer Floor

                const floor = new THREE.Mesh(
                    new THREE.BoxBufferGeometry(10, 5, 10),
                    new THREE.MeshBasicMaterial({ color: '#10e9ee' })
                );
                floor.position.y = -1;
                floor.receiveShadow = true;
                footer_scene.scene.add(floor);
                physics.addMesh(floor);

                // footer_scene camera

                footer_scene.camera.position.set(0, 2, 5);
                footer_scene.camera.lookAt(0, 0, 0);
                footer_scene.camera.rotation.x = 0;
                footer_scene.camera.rotation.y = 0;
                footer_scene.camera.rotation.z = 0;

                console.log(footer_scene.camera);

                // GUI

                var gui = new dat.GUI();
                const cameraFolder = gui.addFolder('Camera');
                cameraFolder
                    .add(footer_scene.camera.position, 'y', 0, 20)
                    .name('camera y');
                cameraFolder
                    .add(footer_scene.camera.position, 'x', 0, 10)
                    .name('camera x');
                cameraFolder
                    .add(footer_scene.camera.position, 'z', 0, 10)
                    .name('camera z');
                cameraFolder
                    .add(footer_scene.camera.rotation, 'y', -1, 1)
                    .name('rotation y');
                cameraFolder
                    .add(footer_scene.camera.rotation, 'x', -1, 1)
                    .name('rotation x');
                cameraFolder
                    .add(footer_scene.camera.rotation, 'z', -1, 1)
                    .name('rotation z');

                const flowControlFolder = gui.addFolder('FlowControl');

                flowControlFolder
                    .add(flowControl.position, 'x', 0, 10)
                    .name('flowControl x');
                flowControlFolder
                    .add(flowControl.position, 'z', 0, 10)
                    .name('flowControl z');
                flowControlFolder
                    .add(flowControl.rotation, 'y', 0, 10)
                    .name('fc rotation y');
                flowControlFolder
                    .add(flowControl.rotation, 'x', 8, 11)
                    .name('fc rotation x');
                flowControlFolder
                    .add(flowControl.rotation, 'z', 0, 10)
                    .name('fc rotation z');

                flowControlFolder
                    .add(flowControl2.position, 'x', 0, 10)
                    .name('flowControl2 x');
                flowControlFolder
                    .add(flowControl2.position, 'z', 0, 10)
                    .name('flowControl2 z');
                flowControlFolder
                    .add(flowControl2.rotation, 'y', 0, 10)
                    .name('fc2 rotation y');
                flowControlFolder
                    .add(flowControl2.rotation, 'x', 8, 11)
                    .name('fc2 rotation x');
                flowControlFolder
                    .add(flowControl2.rotation, 'z', 0, 10)
                    .name('fc2 rotation z');

                // Renderer

                const canvas = document.getElementById('main_canvas');
                renderer = new THREE.WebGLRenderer({
                    canvas,
                    antialias: true,
                    alpha: true,
                });
                renderer.setPixelRatio(window.devicePixelRatio);
                renderer.setSize(window.innerWidth, window.innerHeight);
                renderer.shadowMap.enabled = true;
                renderer.outputEncoding = THREE.sRGBEncoding;
                document.body.appendChild(renderer.domElement);
                stats = new Stats();

                function renderSceneInfo(sceneInfo) {
                    const { scene, camera, elem } = sceneInfo;

                    // get the viewport relative position of this element
                    const {
                        left,
                        right,
                        top,
                        bottom,
                        width,
                        height,
                    } = elem.getBoundingClientRect();
                    const isOffscreen =
                        bottom < 0 ||
                        top > renderer.domElement.clientHeight ||
                        right < 0 ||
                        left > renderer.domElement.clientWidth;

                    if (isOffscreen) {
                        return;
                    }
                    // console.log(renderer)
                    camera.aspect = width / height;
                    camera.updateProjectionMatrix();

                    const positiveYUpBottom =
                        renderer.domElement.clientHeight - bottom;
                    renderer.setScissor(left, positiveYUpBottom, width, height);
                    renderer.setViewport(
                        left,
                        positiveYUpBottom,
                        width,
                        height
                    );
                    renderer.render(scene, camera);
                }

                animate();

                function animate() {
                    requestAnimationFrame(animate);

                    if (hero_lift_index === hero_boxcount) {
                        hero_lift_index = 0;
                    } else {
                        hero_lift_index++;
                    }

                    for (let i = 0; i < 2; i++) {
                        // Picks a random box
                        // Randomly sets a new position at top
                        position.set(
                            Math.random() - 0.5,
                            Math.random() + 6,
                            Math.random() - 0.5
                        );
                        physics.setMeshPosition(
                            hero_boxes[hero_lift_index],
                            position
                        );

                        // hero_boxes.setColorAt( index, color.setHex( 'blue' * Math.random() ) );
                    }

                    if (footer_lift_index === footer_boxcount) {
                        footer_lift_index = 0;
                    } else {
                        footer_lift_index++;
                    }

                    position.set(
                        Math.random() - 0.5,
                        Math.random() + 2,
                        Math.random() - 0.5
                    );
                    physics.setMeshPosition(
                        footer_boxes[footer_lift_index],
                        position
                    );

                    // footer_boxes.setColorAt( index, color.setHex( 'blue' * Math.random() ) );

                    renderSceneInfo(hero_scene);
                    renderSceneInfo(footer_scene);
                    stats.update();
                }
            }
        </script>
    </body>
</html>
